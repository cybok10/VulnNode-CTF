<%- include('partials/header') %>

<h1 class="text-danger mb-4">
    <i class="fa-solid fa-server"></i> System Information
</h1>

<div class="mb-3">
    <a href="/admin" class="btn btn-outline-secondary">
        <i class="fa-solid fa-arrow-left"></i> Back to Admin
    </a>
</div>

<!-- Command Execution (VULNERABILITY) -->
<div class="card bg-dark border-danger mb-4">
    <div class="card-header bg-danger text-white">
        <h5 class="mb-0"><i class="fa-solid fa-terminal"></i> Run System Command</h5>
    </div>
    <div class="card-body">
        <form id="commandForm" onsubmit="runCommand(event)">
            <div class="mb-3">
                <label class="form-label">Command</label>
                <input type="text" class="form-control font-monospace" id="command" placeholder="whoami">
                <small class="text-muted">Examples: whoami, ls, cat /etc/passwd</small>
            </div>
            <button type="submit" class="btn btn-danger">
                <i class="fa-solid fa-play"></i> Execute
            </button>
        </form>
        <div class="mt-3">
            <label class="form-label">Output:</label>
            <pre id="commandOutput" class="bg-black text-success p-3 rounded" style="min-height: 100px;"></pre>
        </div>
    </div>
</div>

<!-- System Stats -->
<div class="card bg-dark border-info mb-4">
    <div class="card-header bg-info text-white">
        <h5 class="mb-0"><i class="fa-solid fa-chart-line"></i> System Statistics</h5>
    </div>
    <div class="card-body" id="systemStats">
        <div class="text-center py-3">
            <div class="spinner-border text-info"></div>
        </div>
    </div>
</div>

<!-- Environment Variables -->
<div class="card bg-dark border-warning">
    <div class="card-header bg-warning text-dark">
        <h5 class="mb-0"><i class="fa-solid fa-code"></i> Environment Variables</h5>
    </div>
    <div class="card-body" id="envVars">
        <div class="text-center py-3">
            <div class="spinner-border text-warning"></div>
        </div>
    </div>
</div>

<script>
function runCommand(e) {
    e.preventDefault();
    
    const command = document.getElementById('command').value;
    
    // VULNERABILITY: Command Injection
    fetch('/api/admin/execute', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ command: command })
    })
    .then(res => res.json())
    .then(data => {
        document.getElementById('commandOutput').textContent = data.output || data.error || 'No output';
    })
    .catch(err => {
        document.getElementById('commandOutput').textContent = 'Error: ' + err.message;
    });
}

function loadSystemInfo() {
    fetch('/serverinfo')
        .then(res => res.json())
        .then(data => {
            document.getElementById('systemStats').innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Node Version:</strong> ${data.node_version}</p>
                        <p><strong>Platform:</strong> ${data.platform}</p>
                        <p><strong>Architecture:</strong> ${data.arch}</p>
                        <p><strong>Process ID:</strong> ${data.pid}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Working Directory:</strong> ${data.cwd}</p>
                        <p><strong>Memory (RSS):</strong> ${(data.memory.rss / 1024 / 1024).toFixed(2)} MB</p>
                        <p><strong>Memory (Heap):</strong> ${(data.memory.heapUsed / 1024 / 1024).toFixed(2)} MB</p>
                    </div>
                </div>
            `;
            
            // VULNERABILITY: Display environment variables (information disclosure)
            let envHtml = '<pre class="bg-black text-light p-3 rounded" style="max-height: 300px; overflow-y: auto;">';
            envHtml += JSON.stringify(data.env, null, 2);
            envHtml += '</pre>';
            document.getElementById('envVars').innerHTML = envHtml;
        })
        .catch(() => {
            document.getElementById('systemStats').innerHTML = '<p class="text-danger">Failed to load system info</p>';
        });
}

document.addEventListener('DOMContentLoaded', loadSystemInfo);
</script>

<%- include('partials/footer') %>